"use strict";function urequest(e){return alipay().my().httpRequest(e)}function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function MD5(e){return e?md5(e):""}function encode$1(e){return base64.encode(e,!1)}function decode$1(e){return base64.decode(e)}function checkEmptyArgument(e){return e.length&&this.checkId(e[0])}function checkId(e){return e&&"string"==typeof e}function getRandomStr(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a=0;a<Number(e);a++)t+=n[Math.round(Math.random()*(n.length-1))];return t}function isNumber(e){return!Number.isNaN(parseInt(e,10))}function compareVersion(e,t){for(var n=String(e).split("."),a=String(t).split("."),i=0;i<Math.max(n.length,a.length);i++){var o=parseInt(n[i]||0,10),r=parseInt(a[i]||0,10);if(o>r)return 1;if(o<r)return-1}return 0}function checkMD5(e,t){try{return e===md5(t)}catch(e){return!1}}function Looper(){}function send(e,t,n){if(RequestHelper.getInstance().isParamsValid(e)){var a=RequestHelper.getInstance().buildSendContent(e);requestQueue.getInstance().send(a,t,n)}}function sendAll(){if(Header.getInstance().isLoaded()){send(constants.REQUEST_TYPE_SESSION_HALF);send(constants.REQUEST_TYPE_SESSION_CLOSE);send(constants.REQUEST_TYPE_EVENT)}else setTimeout(sendAll,100)}function UmengAnalysisLib(){this._inited=!1;this._resumed=!1;this._preLastSendTime=0}function SdkUpdater(){}var appx=require("@alipay/af-appx"),alipay=function(){function e(){this.my=function(){return n||require("@alipay/af-appx").bridge||{}};this.setMy=function(e){n=e}}var t=null,n=null;return function(){t||(t=new e);return t}}(),BuildTarget={ALIPAY:"alipay",QUICKAPP:"quickapp",TARGET:"alipay"},BuildTarget_1=BuildTarget,ulog=function(){function e(){this.setDebug=function(e){n=e};this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.debug.apply(console,arguments)}catch(e){}};this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.info.apply(console,arguments)}catch(e){}}catch(e){}};this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.error.apply(console,arguments)}catch(e){}};this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.warn.apply(console,arguments)}catch(e){}};this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(e){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.info.apply(console,arguments)}catch(e){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]);console.error.apply(console,arguments)}catch(e){}}}var t=null,n=!1;return function(){null===t&&(t=new e);return t}}(),storage={set:alipay().my().setStorage,get:alipay().my().getStorage,remove:alipay().my().removeStorage},ustorage={set:function(e,t,n,a){var i={key:e,success:function(e){"function"==typeof n&&n(e)},fail:function(e,t){"function"==typeof a&&a(e,t)}};i.data=t;storage.set(i)},get:function(e,t,n){storage.get({key:e,success:function(e){"function"==typeof t&&t("alipay"===BuildTarget_1.ALIPAY?e.data:e)},fail:function(e,t){"function"==typeof n&&n(e,t)}})},remove:function(e,t,n){storage.remove({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof n&&n(!1)}})}},jsonUtil={stringify:function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},parse:function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},parseToArray:function(e){if(e)try{return JSON.parse(e)}catch(e){}return[]}},cache=function(){function e(){this.load=function(e){if(a){ustorage.remove(n);e()}else ustorage.get(n,function(t){ustorage.remove(n);a=jsonUtil.parse(t)||{};i=!0;e()})};this.save=function(){a&&ustorage.set(n,jsonUtil.stringify(a),null,function(e,t){ulog().e("cache save failed: ",t,e)})};this.set=function(e,t){a&&(a[e]=t)};this.get=function(e){return(a||{})[e]};this.remove=function(e){a&&a[e]&&delete a[e]};this.clear=function(){a=null};this.has=function(e){return!!this.get(e)};this.isLoaded=function(){return i}}var t=null,n="umeng_cache",a=null,i=!1;return function(){t||(t=new e);return t}}(),LOG_SEND_HOST_PRODUCT="https://ulogs.umeng.com/mpp_logs",SDK_UPDATE_HOST_PRODUCT="https://s.cnzz.com",logSendUrl=LOG_SEND_HOST_PRODUCT,sdkUpdateUrl=SDK_UPDATE_HOST_PRODUCT,constants={NO_SEND_REQUESTS_KEY:"no_send_reqs",SESSION_INTERVAL:0,LOG_URL:logSendUrl,EVENT_PREFIX_KEY:"ekv_",HALF_SESSION_PREFIX_KEY:"halfSession_",CLOSE_SESSION_PREFIX_KEY:"closeSession_",REQUEST_TYPE_SESSION_HALF:1,REQUEST_TYPE_SESSION_CLOSE:2,REQUEST_TYPE_EVENT:3,DEBUG:!0,DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",EVENT_SEND_MIN_INTERVAL:5,EVENT_SEND_MAX_INTERVAL:86400,EVENT_LAST_SEND_TIME_KEY:"last_send_time",REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT_KEY:"imprint",DOWNLOAD_FILE_FIRST_CACHE:"hot_update_first",DOWNLOAD_FILE_SECOND_CACHE:"hot_update_second",SDK_UPDATE_SERVER_ADDRESS:sdkUpdateUrl+"/sdk/alipay",SDK_UPDATE_LOCAL_STORAGE_PATH:"internal://files/umengsdk/",SDK_CODE:"umeng_sdk_cache",SDK_INFO:"umeng_sdk_info",SEED_VERSION:"1.0.0",IMPL_VERSION:"1.0.0",ALIPAY_AVAILABLE:"10.1.52",ALIPAYID_EMPTY_FLAGE:"alipay_id_empty_",ALIPAY_FAKE_ID:"alipay_fake_id"},commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},md5=createCommonjsModule(function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t){return e<<t|e>>>32-t}function i(e,t,i,o,r,s){return n(a(n(n(t,e),n(o,s)),r),i)}function o(e,t,n,a,o,r,s){return i(t&n|~t&a,e,t,o,r,s)}function r(e,t,n,a,o,r,s){return i(t&a|n&~a,e,t,o,r,s)}function s(e,t,n,a,o,r,s){return i(t^n^a,e,t,o,r,s)}function c(e,t,n,a,o,r,s){return i(n^(t|~a),e,t,o,r,s)}function u(e,t){e[t>>5]|=128<<t%32;e[14+(t+64>>>9<<4)]=t;var a,i,u,f,l,_=1732584193,d=-271733879,E=-1732584194,g=271733878;for(a=0;a<e.length;a+=16){i=_;u=d;f=E;l=g;d=c(d=c(d=c(d=c(d=s(d=s(d=s(d=s(d=r(d=r(d=r(d=r(d=o(d=o(d=o(d=o(d,E=o(E,g=o(g,_=o(_,d,E,g,e[a],7,-680876936),d,E,e[a+1],12,-389564586),_,d,e[a+2],17,606105819),g,_,e[a+3],22,-1044525330),E=o(E,g=o(g,_=o(_,d,E,g,e[a+4],7,-176418897),d,E,e[a+5],12,1200080426),_,d,e[a+6],17,-1473231341),g,_,e[a+7],22,-45705983),E=o(E,g=o(g,_=o(_,d,E,g,e[a+8],7,1770035416),d,E,e[a+9],12,-1958414417),_,d,e[a+10],17,-42063),g,_,e[a+11],22,-1990404162),E=o(E,g=o(g,_=o(_,d,E,g,e[a+12],7,1804603682),d,E,e[a+13],12,-40341101),_,d,e[a+14],17,-1502002290),g,_,e[a+15],22,1236535329),E=r(E,g=r(g,_=r(_,d,E,g,e[a+1],5,-165796510),d,E,e[a+6],9,-1069501632),_,d,e[a+11],14,643717713),g,_,e[a],20,-373897302),E=r(E,g=r(g,_=r(_,d,E,g,e[a+5],5,-701558691),d,E,e[a+10],9,38016083),_,d,e[a+15],14,-660478335),g,_,e[a+4],20,-405537848),E=r(E,g=r(g,_=r(_,d,E,g,e[a+9],5,568446438),d,E,e[a+14],9,-1019803690),_,d,e[a+3],14,-187363961),g,_,e[a+8],20,1163531501),E=r(E,g=r(g,_=r(_,d,E,g,e[a+13],5,-1444681467),d,E,e[a+2],9,-51403784),_,d,e[a+7],14,1735328473),g,_,e[a+12],20,-1926607734),E=s(E,g=s(g,_=s(_,d,E,g,e[a+5],4,-378558),d,E,e[a+8],11,-2022574463),_,d,e[a+11],16,1839030562),g,_,e[a+14],23,-35309556),E=s(E,g=s(g,_=s(_,d,E,g,e[a+1],4,-1530992060),d,E,e[a+4],11,1272893353),_,d,e[a+7],16,-155497632),g,_,e[a+10],23,-1094730640),E=s(E,g=s(g,_=s(_,d,E,g,e[a+13],4,681279174),d,E,e[a],11,-358537222),_,d,e[a+3],16,-722521979),g,_,e[a+6],23,76029189),E=s(E,g=s(g,_=s(_,d,E,g,e[a+9],4,-640364487),d,E,e[a+12],11,-421815835),_,d,e[a+15],16,530742520),g,_,e[a+2],23,-995338651),E=c(E,g=c(g,_=c(_,d,E,g,e[a],6,-198630844),d,E,e[a+7],10,1126891415),_,d,e[a+14],15,-1416354905),g,_,e[a+5],21,-57434055),E=c(E,g=c(g,_=c(_,d,E,g,e[a+12],6,1700485571),d,E,e[a+3],10,-1894986606),_,d,e[a+10],15,-1051523),g,_,e[a+1],21,-2054922799),E=c(E,g=c(g,_=c(_,d,E,g,e[a+8],6,1873313359),d,E,e[a+15],10,-30611744),_,d,e[a+6],15,-1560198380),g,_,e[a+13],21,1309151649),E=c(E,g=c(g,_=c(_,d,E,g,e[a+4],6,-145523070),d,E,e[a+11],10,-1120210379),_,d,e[a+2],15,718787259),g,_,e[a+9],21,-343485551);_=n(_,i);d=n(d,u);E=n(E,f);g=n(g,l)}return[_,d,E,g]}function f(e){var t,n="",a=32*e.length;for(t=0;t<a;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];n[(e.length>>2)-1]=void 0;for(t=0;t<n.length;t+=1)n[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function _(e){return f(u(l(e),8*e.length))}function d(e,t){var n,a,i=l(e),o=[],r=[];o[15]=r[15]=void 0;i.length>16&&(i=u(i,8*e.length));for(n=0;n<16;n+=1){o[n]=909522486^i[n];r[n]=1549556828^i[n]}a=u(o.concat(l(t)),512+8*t.length);return f(u(r.concat(a),640))}function E(e){var t,n,a="";for(n=0;n<e.length;n+=1){t=e.charCodeAt(n);a+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t)}return a}function g(e){return unescape(encodeURIComponent(e))}function h(e){return _(g(e))}function S(e){return E(h(e))}function p(e,t){return d(g(e),g(t))}function I(e,t){return E(p(e,t))}function y(e,t,n){return t?n?p(t,e):I(t,e):n?h(e):S(e)}e.exports?e.exports=y:t.md5=y}(commonjsGlobal)}),b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},n=0,a=e.length;n<a;n++)t[e.charAt(n)]=n;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[b64chars.charAt(n>>>18),b64chars.charAt(n>>>12&63),t>=2?"=":b64chars.charAt(n>>>6&63),t>=1?"=":b64chars.charAt(63&n)].join("")},btoa=function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return fromCharCode(55296+(t>>>10))+fromCharCode(56320+(1023&t));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,n=t%4,a=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),i=[fromCharCode(a>>>16),fromCharCode(a>>>8&255),fromCharCode(255&a)];i.length-=[0,0,2,1][n];return i.join("")},atob=function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},base64={encode:encode,decode:decode},utils={MD5:MD5,encode:encode$1,decode:decode$1,checkEmptyArgument:checkEmptyArgument,checkId:checkId,isNumber:isNumber,checkMD5:checkMD5,compareVersion:compareVersion,getRandomStr:getRandomStr},udevice={getAlipaySystemInfoSync:function(){try{return alipay().my().getSystemInfoSync()}catch(e){ulog().err("获取SystemInfo异常")}},getSystemInfo:function(e,t){alipay().my().getSystemInfo({success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(e){try{alipay().my().call("getDeviceInfo",{},function(t){var n=(t||{}).data;if(n){cache().set(constants.DEVICE_INFO_KEY,n);"function"==typeof e&&e(n)}else{var a=cache().get(constants.DEVICE_INFO_KEY);"function"==typeof e&&e(a)}})}catch(e){ulog().w("支付宝获取设备info 失败",e)}},getNetworkInfo:function(e,t){var n={success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}};alipay().my().getNetworkType(n)},checkNetworkAvailable:function(e){alipay().my().getNetworkType({success:function(t){"function"==typeof e&&e(t.networkAvailable)},fail:function(){"function"==typeof e&&e(!1)}})},getDeviceId:function(e,t){"function"==typeof e&&e("")},getAdvertisingId:function(e,t){"function"==typeof e&&e("")},getUserId:function(e){try{alipay().my().call("getOpenUserData",{},function(t){(t||{}).uid||ulog().err('请确保已经勾选支付宝功能包中的"友盟+数据服务"功能包！');"function"==typeof e&&e((t||{}).uid)})}catch(t){e("")}},getUniqueId:function(e){var t=cache().get("umeng_uniqueid");t?"function"==typeof e&&e(t):this._buildUniqueId(e)},getPageName:function(){},onNetworkStatusChange:function(e){alipay().my().onNetworkStatusChange(function(t){"function"==typeof e&&e(t.isConnected||!0)})},getFakeUniqueId:function(){var e=cache().get(constants.ALIPAY_FAKE_ID);e||(e=this._buildFakeUniqueId());return e},_buildFakeUniqueId:function(){var e=constants.ALIPAYID_EMPTY_FLAGE+(new Date).getTime()+utils.getRandomStr(10);cache().set(constants.ALIPAY_FAKE_ID,e);return e},_buildUniqueId:function(e){var t=this;t.getDeviceId(function(n){t.getAdvertisingId(function(a){t.getUserId(function(t){var i=n||a||t;cache().set(constants.ADVERTISING_ID,a);cache().set(constants.ANDROID_ID,n);cache().set("umeng_uniqueid",i);e(i)})})})}},PRE_PAGE_KEY="page_",PageController=function(){this._pagelist=[];this._currentPage={};this.hasTracked=!1};PageController.prototype={startPage:function(e){if(e&&!this.hasTracked){this._currentPage={ts:Date.now(),page_name:e};this.hasTracked=!0}},endPage:function(e,t){if(this.hasTracked&&e&&t&&this._currentPage&&t===this._currentPage.page_name){var n=Date.now()-this._currentPage.ts;this._currentPage.duration=Math.abs(n);this._pagelist=this._pagelist.concat(this._currentPage);this._currentPage=null;this.savePages(e);this.hasTracked=!1}},savePages:function(e){e&&this._pagelist.length>0&&this.updateStorage(PRE_PAGE_KEY+e,this._pagelist)},getPages:function(e){var t=cache().get(PRE_PAGE_KEY+e),n=jsonUtil.parseToArray(t).concat(this._pagelist);this.clear(e);return n},updateStorage:function(e,t){if(Array.isArray(t)&&t.length>0){var n=cache().get(e);t=jsonUtil.parseToArray(n).concat(t);cache().set(e,jsonUtil.stringify(t));this._pagelist.length=0}},clear:function(e){cache().remove(PRE_PAGE_KEY+e);this._pagelist=[]}};var CLOSED_SESSIONS_KEY="closed_sessions",HALF_SESSIONS_KEY="half_sessions",CURRENT_SESSION_KEY="current_session",PAGE_END_TIME_KEY="page_endtime",Session=function(){function e(){return{trackPageStart:function(e){l.startPage(e)},trackPageEnd:function(e){l.endPage((r||{}).id,e)},getCurrentSessionId:function(){return(r||{}).id},getCurrentSession:function(){return r},getSessions:function(){return jsonUtil.parseToArray(cache().get(CLOSED_SESSIONS_KEY))},getHalfSessions:function(){return jsonUtil.parseToArray(cache().get(HALF_SESSIONS_KEY))},resume:function(e,t){c=e;u=t;n()},pause:function(){if(r){s=Date.now();r.end_time=s;cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(r));cache().set(PAGE_END_TIME_KEY,s)}},clearSessions:function(){cache().remove(CLOSED_SESSIONS_KEY)},clearHalfSession:function(){cache().remove(HALF_SESSIONS_KEY)}}}function t(e){var t=Date.now();udevice.getUniqueId(function(n){var a=utils.MD5(t+":::"+c+":::"+n);e(a)})}function n(){var e=Date.now();if(r){if(s&&e-s>constants.SESSION_INTERVAL){a(s);i(r)}}else{var t=cache().get(CURRENT_SESSION_KEY);if(t)if(r=jsonUtil.parse(t)){var n=cache().get(PAGE_END_TIME_KEY);s=n;if(n&&e-n>constants.SESSION_INTERVAL){a(n);i(r)}}else i(null);else i(null)}}function a(e){try{r.end_time=parseInt(e,10)}catch(t){r.end_time=e}var t=e-r.start_time;r.duration=t}function i(e){var n=e?e.id:"";t(function(t){r={id:t,start_time:Date.now()};cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(r));if(e){var a=l.getPages(n);if(Array.isArray(a)&&a.length>0){e.pages=a;e.$page_num=a.length}var i=cache().get(CLOSED_SESSIONS_KEY),s=jsonUtil.parseToArray(i).concat(e);cache().set(CLOSED_SESSIONS_KEY,jsonUtil.stringify(s))}o()})}function o(){if(r){var e=cache().get(HALF_SESSIONS_KEY);e=jsonUtil.parseToArray(e).concat(r);cache().set(HALF_SESSIONS_KEY,jsonUtil.stringify(e));"function"==typeof u&&u(r.id)}}var r,s,c="",u=null,f=null,l=new PageController;return{getInstance:function(){f||(f=e());return f}}}(),uapp={getVersionName:function(){return""},getVersionCode:function(){return""},getSourceExtra:function(){return""},getPackageName:function(){return""}},MOBILE_NETWORK_2G="2g",MOBILE_NETWORK_3G="3g",MOBILE_NETWORK_4G="4g",MOBILE_NETWORK_NONE="none",BLANK_SPACE=" ",UMENG_ADVERTISTING_ID="idfa",UMENG_ANDROID_ID="android_id",Header=function(){function e(){function e(e,o){udevice.getSystemInfo(function(s){udevice.getUniqueId(function(c){udevice.getNetworkInfo(function(u){var f=u.type||u.networkType;f===MOBILE_NETWORK_NONE&&(f="unknown");var l=cache().get(constants.IMPRINT_KEY);l&&(r.imprint=l);var _=cache().get(constants.ADVERTISING_ID);if(_){var d=t(_);if(d){var E=n(UMENG_ADVERTISTING_ID,d);r.id_tracking=E}}var g=cache().get(constants.ANDROID_ID);if(g){var h=t(g);h&&(r.id_tracking&&r.id_tracking.snapshots?r.id_tracking.snapshots[UMENG_ANDROID_ID]=h:r.id_tracking=n(UMENG_ANDROID_ID,h))}a(e,s,c,f);i(s);o()})})})}function t(e){if(e)return{identity:e,version:1,ts:Date.now()}}function n(e,t){var n={snapshots:{}};n.snapshots[e]=t;return n}function a(e,t,n,a){r.app_version=uapp.getVersionName();r.app_source_extra=uapp.getSourceExtra();r.device_type="Phone";r.sdk_type="alipaymp";r.sdk_version=constants.IMPL_VERSION;r.appkey=e;n||"alipay"!==BuildTarget_1.ALIPAY||(n=s);r.idmd5=utils.MD5(n);r.pro_ver="1";if(t){var i,o,c,u=t.model,f=t.brand,l=f.toLowerCase();udevice.getUserId(function(e){r.alipay_id=e||s});c=(i=t.screenWidth*t.pixelRatio)>(o=t.screenHeight*t.pixelRatio)?i+"*"+o:o+"*"+i;r.os=t.platform;r.font_size_setting=t.fontSizeSetting;r.device_model=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;r.device_brand=f;r.channel=l;r.device_manufacturer=l;r.device_manuid=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;r.device_name=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;r.os_version=t.system;r.resolution=c;r.language=t.language;r.alipay_version=t.version;r.platform="alipaymp";r.current_client="alipay";r.inner={sd:{t:t.storage,ts:Date.now()},by:[{le:t.currentBattery,ts:Date.now()}]}}switch(a){case MOBILE_NETWORK_4G:r.access_subtype="LTE";r.access="2G/3G";break;case MOBILE_NETWORK_3G:r.access_subtype="CDMA";r.access="2G/3G";break;case MOBILE_NETWORK_2G:r.access_subtype="GRPS";r.access="2G/3G";break;default:r.access=a;delete r.access_subtype}}function i(e){var t=[];if(e){t.push({name:"系统名",value:e.platform});t.push({name:"支付宝版本号",value:e.version})}t.push({name:"设备型号",value:r.device_model});t.push({name:"设备生产商",value:r.device_brand});t.push({name:"os版本号",value:r.os_version});t.push({name:"网络类型",value:r.access});t.push({name:"运营商",value:r.access_subtype});t.push({name:"分辨率",value:r.resolution});for(var n="",a=0;a<t.length;a++){var i=t[a];n+=i.name+": "+i.value+"; "}ulog().v("info: ",n)}var o=!1,r={},s=udevice.getFakeUniqueId();return{init:function(t){udevice.getUserId(function(n){udevice.getDeviceInfo(function(a){e(t,function(){o=!0;r.alipay_id=n||s;r.device_info=a||""})})})},isLoaded:function(){return o},get:function(e){switch(e){case constants.REQUEST_TYPE_SESSION_HALF:r.st="1";break;case constants.REQUEST_TYPE_SESSION_CLOSE:case constants.REQUEST_TYPE_EVENT:r.st&&delete r.st}return JSON.parse(JSON.stringify(r))},setItem:function(e,t){r[e]=t},getItem:function(e){return r[e]},updateExtraInfo:function(){udevice.getDeviceInfo(function(e){r.device_info=e||""})}}}var t=null;return{getInstance:function(){t||(t=e());return t}}}(),EKVS_KEY="ekvs",EVENT_MAX_COUNT=1e4,MEMORY_DATA_COUNT=1,EventManager=function(){function e(e,t){var n={id:e,ts:Date.now()};switch(typeof t){case"string":n[e]=t;break;case"object":for(var a in t)({}).hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n}function t(e){if(e)if(Session.getInstance().getCurrentSessionId()){c.unshift(e);c.length>=MEMORY_DATA_COUNT&&a()}else{ulog().w("session id is null");u.unshift(e)}}function n(e){var t=0;e.forEach(function(e){for(var n in e)e[n]&&(t+=e[n].length)});return t}function a(){if(c.length){var e=jsonUtil.parseToArray(cache().get(EKVS_KEY));if(n(e)+c.length<=EVENT_MAX_COUNT){var t=o(e,c);cache().set(EKVS_KEY,jsonUtil.stringify(t))}c.length=0}}function i(e){t(e)}function o(e,t){for(var n=Session.getInstance().getCurrentSessionId(),a=0,i=[];a<e.length&&!(i=e[a][n]);a++);if(Array.isArray(i)&&i.length)e[a][n]=i.concat(t);else{var o={};o[n]=t;e.push(o)}return e}function r(){this.readEkvs=function(){var e=[],t=cache().get(EKVS_KEY);if(t){var n=jsonUtil.parseToArray(t);e=c&&c.length?o(n,c):n}return e};this.clearEkvs=function(){cache().remove(EKVS_KEY);c.length=0};this.addEvent=function(t,n){i(e(t,n))};this.addSessionId=function(){var e=Session.getInstance().getCurrentSessionId();if(Array.isArray(u)&&u.length&&e){for(var t=0;t<u.length;t++)i(u[t]);u.length=0}};this.quit=function(){if(c.length){var e=cache().get(EKVS_KEY),t=o(jsonUtil.parseToArray(e),c);cache().set(EKVS_KEY,jsonUtil.stringify(t));c.length=0}}}var s,c=[],u=[];return{getInstance:function(){s||(s=new r);return s}}}(),RequestHelper=function(){function e(e){var t="";switch(e){case constants.REQUEST_TYPE_SESSION_HALF:t=constants.HALF_SESSION_PREFIX_KEY;break;case constants.REQUEST_TYPE_SESSION_CLOSE:t=constants.CLOSE_SESSION_PREFIX_KEY;break;case constants.REQUEST_TYPE_EVENT:t=constants.EVENT_PREFIX_KEY}return t}function t(){return{isParamsValid:function(e){return-1!==[constants.REQUEST_TYPE_SESSION_HALF,constants.REQUEST_TYPE_SESSION_CLOSE,constants.REQUEST_TYPE_EVENT].indexOf(e)},buildSendContent:function(t){if(Header.getInstance().get(t)){var n={header:Header.getInstance().get(t),analytics:null};switch(t){case constants.REQUEST_TYPE_SESSION_HALF:var a=Session.getInstance().getHalfSessions();if(a&&a.length){Session.getInstance().clearHalfSession();n.analytics={sessions:a}}break;case constants.REQUEST_TYPE_SESSION_CLOSE:var i=Session.getInstance().getSessions();if(i&&i.length){Session.getInstance().clearSessions();n.analytics={sessions:i}}break;case constants.REQUEST_TYPE_EVENT:var o=EventManager.getInstance().readEkvs();if(Array.isArray(o)&&o.length){EventManager.getInstance().clearEkvs();n.analytics={ekv:o}}}var r="";if(n.analytics){var s=jsonUtil.stringify(n);r=e(t)+utils.MD5(s)}return{data:n,key:r}}}}}var n;return{getInstance:function(){n||(n=t());return n}}}();Looper.prototype={prepare:function(e){this._queue=e;this._running=!1;this._forceStop=!1},run:function(){if(!this._forceStop)if(this._queue){if(!this._running){this._running=!0;for(;this._running;)try{this._queue.dispatchMessage()}catch(e){}}}else ulog().w("requestQueue is null")},wait:function(){this._running=!1},forceStop:function(){this._forceStop=!0},cancelForceStop:function(){this._forceStop=!1;this.run()}};var MAX_REQUEST_COUNT=1,MAX_FAIL_COUNT=5,requestQueue=function(){function e(e,a){var i=e.key,o=jsonUtil.stringify(e.data),r=e.success,s=e.fail;ulog().i("开始发送数据");urequest({url:constants.LOG_URL,method:"POST",data:utils.encode(o),headers:{"Content-Type":"alipaymp/json","Msg-Type":"alipaymp/json"},success:function(a){var c=a.code||a.status;if(200===c||413===c){ulog().i("数据发送成功: ",c);E=0;t((a.data||{}).imprint);"function"==typeof r&&r(i)}else{n(e);"function"==typeof s&&s(i,o)}},fail:function(t){ulog().w("数据发送失败: ",t);E+=1;n(e);"function"==typeof s&&s(i,o)},complete:function(){"function"==typeof a&&a(i)}})}function t(e){try{if(e){cache().set(constants.IMPRINT_KEY,e);Header.getInstance().setItem("imprint",e);var t=jsonUtil.parse(utils.decode(e)),n=t.report_policy;if(n&&utils.isNumber(n)){cache().set(constants.REPORT_POLICY,n);if(n===constants.REPORT_POLICY_INTERVAL){var a=t.report_interval;if(a&&utils.isNumber(a)){a<=constants.EVENT_SEND_MIN_INTERVAL?a=constants.EVENT_SEND_MIN_INTERVAL:a>constants.EVENT_SEND_MAX_INTERVAL&&(a=constants.EVENT_SEND_MAX_INTERVAL);cache().set(constants.REPORT_INTERVAL_TIME,a)}}}}}catch(e){}}function n(e){_.unshift(e)}function a(){return cache().get(constants.NO_SEND_REQUESTS_KEY)||[]}function i(){cache().set(constants.NO_SEND_REQUESTS_KEY,[].concat(_))}function o(e,t){return e.concat(t)}function r(e,t){for(var n=0;n<t.length;n++)for(var a in t[n])e[a]?e[a]=e[a].concat(t[n][a]):e[a]=t[n][a];return e}function s(e){var t=[],n=[],a={},i={},s={},c={},u={},f={};if(e.length){for(var l=0;l<e.length;l++){var _=e[l].data;switch(e[l].key.split("_")[0]+"_"){case constants.HALF_SESSION_PREFIX_KEY:t=o(t,_.analytics.sessions);i.key=e[l].key;u=_.header;break;case constants.EVENT_PREFIX_KEY:a=r(a,_.analytics.ekv);c.key=e[l].key;f=_.header;break;case constants.CLOSE_SESSION_PREFIX_KEY:n=o(n,_.analytics.sessions);s.key=e[l].key}}i.data={header:u,analytics:{sessions:t}};s.data={header:f,analytics:{sessions:n}};c.data={header:f,analytics:{ekv:[a]}}}return{mergedHalfSessions:i,mergedCloseSessions:s,mergedEkvs:c}}function c(e){var t=s(e),n=[];for(var a in t)t[a].key&&n.push(t[a]);return n}function u(){this.send=function(e,t,n){if(e&&e.key&&e.data&&e.data.analytics){e.success=t;e.fail=n;_.unshift(e);E>=MAX_FAIL_COUNT&&(E-=1);l.run()}};this.dispatchMessage=function(){if(d>=MAX_REQUEST_COUNT||!g||E>=MAX_FAIL_COUNT)l.wait();else{var t=_.pop();if(t&&t.key&&t.data){d+=1;e(t,function(){d-=1;l.run()})}else l.wait()}};this.resume=function(){var e=a();e=c(e);_=_.concat(e)};this.pause=function(){i();_.length=0;l.wait()}}var f,l,_=[],d=0,E=0,g=!0;return{getInstance:function(){if(!f){f=new u;(l=new Looper).prepare(f)}return f}}}(),Request={send:send,sendAll:sendAll};UmengAnalysisLib.prototype={init:function(e,t,n){ulog().v("sdk version: "+constants.IMPL_VERSION);if(this._inited)ulog().v("Lib重复实例化");else if(e){var a=this;cache().load(function(){ulog().v("cache加载成功");a._init(e,t);a._inited=!0;"function"==typeof n&&n();ulog().tip("SDK集成成功")})}else{this._inited=!1;ulog().err("appkey不能为空，请确保传入正确的appkey")}},_init:function(e){Header.getInstance().init(e);ulog().v("Header初始化成功");requestQueue.getInstance();ulog().v("请求队列初始化成功");this._bindAuthChange();this._handleQuit()},_bindAuthChange:function(){try{alipay().my().on("alipayAuthChange",function(e){e&&e.data&&e.data.authcode&&Header.getInstance().updateExtraInfo()})}catch(e){ulog().e("绑定auth change异常: ",e)}},_handleQuit:function(){},_sendPolicy:function(){var e=cache().get(constants.REPORT_POLICY);if(e&&e===constants.REPORT_POLICY_INTERVAL){var t=cache().get(constants.REPORT_INTERVAL_TIME),n=cache().get(constants.EVENT_LAST_SEND_TIME_KEY),a=!n;t=t||constants.EVENT_SEND_MIN_INTERVAL;if(a=a||Date.now()-n>1e3*t){var i=this;i._updateLastSendTime();Request.send(constants.REQUEST_TYPE_EVENT,null,function(){i._recoverLastSendTime()})}}},_updateLastSendTime:function(){this._preLastSendTime=cache().get(constants.EVENT_LAST_SEND_TIME_KEY);cache().set(constants.EVENT_LAST_SEND_TIME_KEY,Date.now())},_recoverLastSendTime:function(){cache().set(constants.EVENT_LAST_SEND_TIME_KEY,this._preLastSendTime)},resume:function(e){if(this._inited&&!this._resumed){this._resumed=!0;e&&this.trackPageStart(e);requestQueue.getInstance().resume();Session.getInstance().resume(this.appkey,function(e){ulog().v("创建新会话: "+e);EventManager.getInstance().addSessionId();Request.sendAll()})}},pause:function(e){if(this._inited&&this._resumed){this._resumed=!1;e&&this.trackPageEnd(e);requestQueue.getInstance().pause();Session.getInstance().pause();EventManager.getInstance().quit();cache().save();ulog().v("退出会话")}},trackEvent:function(e,t){if(this._inited)if(utils.checkId(e))if(t&&"[object Object]"!==Object.prototype.toString.call(t)&&"[object String]"!==Object.prototype.toString.call(t))ulog().e("please check trackEvent attr. attr should be string or object(not include Array)");else{ulog().v("event id: "+jsonUtil.stringify(e)+(t?" || event attr: "+jsonUtil.stringify(t):""));EventManager.getInstance().addEvent(e,t);this._sendPolicy()}else ulog().e("event id should be string and can not be null")},trackPageStart:function(e){this._inited&&Session.getInstance().trackPageStart(e)},trackPageEnd:function(e){this._inited&&Session.getInstance().trackPageEnd(e)}};var STATUS={SUCCESS:0,FAIL:-1},modules$1={"@alipay/af-appx":appx,md5:md5,base64:base64},callQueue=[];SdkUpdater.prototype={loadSDK:function(e){var t=this;try{ustorage.get(constants.SDK_INFO,function(n){n&&n.md5?t.readSDKCode(n,function(t,a){e(t,a,n)}):e(STATUS.FAIL)})}catch(t){e(STATUS.FAIL)}},readSDKCode:function(e,t){try{ulog().v("current sdk:"+e.version+e.md5+e.filePath);ustorage.get(constants.SDK_CODE,function(n){var a=utils.decode(n);utils.checkMD5(e.md5,a)?t(STATUS.SUCCESS,a):t(STATUS.FAIL)},function(){t(STATUS.FAIL)})}catch(e){t(STATUS.FAIL)}},downloadSDK:function(e){try{urequest({url:e.fileUrl,dataType:"text",success:function(t){try{var n=t.data;"string"==typeof n&&n.length>0&&utils.checkMD5(e.md5,n)&&ustorage.set(constants.SDK_CODE,utils.encode(n),function(){ustorage.set(constants.SDK_INFO,e)},function(){ustorage.remove(constants.SDK_CODE);ustorage.remove(constants.SDK_INFO)})}catch(e){ulog().w("sdk保存时遇到异常: "+e)}},fail:function(){}})}catch(e){}},checkVersionNew:function(e){var t=this;udevice.getSystemInfo(function(n){e.systemInfo=n;urequest({url:constants.SDK_UPDATE_SERVER_ADDRESS,method:"POST",data:e,success:function(e){if(200===e.status)try{var n=e.data;if(200===n.code&&n.data&&n.data.update){var a=n.data.info;a&&a.fileUrl&&a.md5&&t.downloadSDK(a)}}catch(e){ulog().w("check new version error: request failed")}},fail:function(e,t){ulog().w("check new version fail",e,t)},complete:function(){ulog().v("check new version complete")}})})},createMethod:function(e,t,n){try{e[t]=n?function(){return n[t].apply(n,arguments)}:function(){callQueue.push([t,[].slice.call(arguments)])}}catch(e){ulog().v("create method errror: ",e)}},installApi:function(e,t){try{var n,a,i=["resume","pause","trackEvent","trackPageStart","trackPageEnd"];for(n=0,a=i.length;n<a;n++)this.createMethod(e,i[n],t);if(t)for(n=0,a=callQueue.length;n<a;n++){var o=callQueue[n];t[o[0]].apply(t,o[1])}}catch(e){ulog().v("install api errror: ",e)}},compileModule:function(sdkCode){var module={exports:{}},require=function(e){var t=e.split("/"),n=t[t.length-1];return modules$1[n]||{}};eval(sdkCode,require);return module.exports},loadModule:function(e,t){var n;if(e===STATUS.FAIL){n=UmengAnalysisLib;ulog().i("load sdk failed: use origin uma_impl")}else try{n=this.compileModule(t)}catch(e){n=UmengAnalysisLib;ulog().w("compileModule failed: use origin uma_impl")}return n}};var umengAnalysis={_inited:!1,init:function(e,t,n){if(this._inited)ulog().v("已经实例过，请避免重复初始化");else{var a=this;n=n||{};var i=new SdkUpdater;i.installApi(a,null);ulog().v("安装临时接口成功");if(e)if("object"==typeof t){alipay().setMy(t);ulog().v("保存my对象");var o=udevice.getAlipaySystemInfoSync();if(o&&o.version&&utils.compareVersion(o.version,constants.ALIPAY_AVAILABLE)<0)ulog().err("请保证您的支付宝版本号大于等于10.1.52版本！");else{this._inited=!0;ulog().setDebug(n.debug);try{var r=new UmengAnalysisLib;ulog().v("成功创建Lib对象");r.init(e,t,function(){ulog().v("Lib对象初始化成功");i.installApi(a,r);ulog().v("安装Lib接口");"function"==typeof n.callback&&n.callback()})}catch(e){ulog().w("创建Lib对象异常: "+e)}}}else ulog().err("请您传入正确的 my 对象");else ulog().err("appkey不能为空，请确保传入正确的appkey")}}};module.exports=umengAnalysis;
